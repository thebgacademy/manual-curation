// For format details, see https://aka.ms/devcontainer.json. For config options, see the
// README at: https://github.com/devcontainers/templates/tree/main/src/docker-existing-dockerfile
{
	"name": "Existing Dockerfile",
	"build": {
		// Sets the run context to one level up instead of the .devcontainer folder.
		"context": "..",
		// Update the 'dockerFile' property if you aren't using the standard 'Dockerfile' filename.
		"dockerfile": "Dockerfile"
	},
	"features": {
		"ghcr.io/devcontainers/features/desktop-lite:1": {
			"version": "latest",
			"noVncVersion": "1.2.0",
			"password": "password",
			"webPort": "6080",
			"vncPort": "5901"
		},
		"ghcr.io/rocker-org/devcontainer-features/miniforge:1": {
			"version": "latest",
			"variant": "Mambaforge"
		},
		"ghcr.io/wxw-matt/devcontainer-features/apt:latest": {
			"packages": "vim"
        },
		"ghcr.io/wxw-matt/devcontainer-features/command_runner:latest": {
			"command1": "mamba create -n rapid -c bioconda perl-bioperl seqtk python=3.10 pyfastaq -y",
			"command2": "/opt/conda/envs/rapid/bin/pip3 install click ruff",
			"command3": "sudo /opt/conda/envs/rapid/bin/pip3 install --root-user-action ignore --editable /agp-tpf-utils/" 
		}
	},

	// Use 'forwardPorts' to make a list of ports inside the container available locally.
	"forwardPorts": [
		6080
	],

	"portsAttributes": {
		"6080": {
			"label": "Desktop access (password: vscode)",
			"onAutoForward": "silent"
		}
	},

	"postCreateCommand": "unzip ../../PretextView_Linux-x86-64.zip && tar xzf ../../rapid-curation-main.tar.gz && mv rapid-curation-main-test_data/test_data ./ && rm -rf rapid-curation-main-test_data && gunzip test_data/*.gz",

	"postAttachCommand": "bash welcome.sh"
}
